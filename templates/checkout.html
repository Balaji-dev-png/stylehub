
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <script>
        // Inject theme early to prevent flash of white content
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Stylehub</title>
    <link rel="stylesheet" href="{% static 'theme.css' %}?v=3">
    <link rel="stylesheet" href="{% static 'style6.css' %}?v=2">
    <script src="{% static 'main.js' %}?v=3" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <header class="checkout-header">
        <div class="logo">Style<span>hub</span></div>
        <a href="{% url 'cart' %}" class="back-link">‚Üê Return to Cart</a>
        <button id="theme-toggle" class="theme-toggle">üåô</button>
    </header>

    <main class="container">
        <div class="checkout-layout">
            
            <form class="checkout-forms" method="POST" action="{% url 'place_order' %}">
                {% csrf_token %}
                
                <section class="form-section">
                    <h2>Contact Information</h2>
                    <input type="email" name="email" placeholder="Email Address" value="{{ user.email }}" required>
                </section>

                <section class="form-section">
                    <h2>Shipping Address</h2>
                    <div class="form-row">
                        <input type="text" name="first_name" placeholder="First Name" class="half" value="{{ user.first_name }}" required>
                        <input type="text" name="last_name" placeholder="Last Name" class="half" value="{{ user.last_name }}" required>
                    </div>
                    <input type="text" name="address" placeholder="Address" value="{{ profile.address|default:'' }}" required>
                    <div class="form-row">
                        <input type="text" name="city" placeholder="City" class="third" value="{{ profile.city|default:'' }}" required>
                        <input type="text" name="state" placeholder="State" class="third" value="{{ profile.state|default:'' }}" required>
                        <input type="text" name="zip" placeholder="ZIP code" class="third" value="{{ profile.zip_code|default:'' }}" required oninput="validateStrictNumber(this)">
                    </div>
                </section>

                <!-- <section class="form-section">
                    <h2>Payment Simulation</h2>
                    <p class="subtitle">Dummy payment (Success/Fail random)</p>
                    <div class="payment-box">
                        <div class="payment-body">
                            <input type="text" name="card_number" placeholder="Card Number (Any)" required oninput="validateStrictNumber(this)">
                            <div class="form-row">
                                <input type="text" name="expiry" placeholder="MM/YY" class="half" required>
                                <input type="text" name="cvv" placeholder="CVV" class="half" required oninput="validateStrictNumber(this)">
                            </div>
                        </div>
                    </div>
                </section> -->

                <section class="form-section">
                    <h2>Secure Payment</h2>
                    <p class="subtitle" style="color: #666; font-size: 13px; margin-bottom: 15px;">
                        üîí You will be redirected to Stripe's secure checkout page to enter your credit card details.
                    </p>
                </section>

                <button type="submit" class="place-order-btn">Proceed Payment</button>
            </form>

            <aside class="order-summary">
                {% for item in cart.items.all %}
                <div class="summary-item">
                    <div class="item-img">
                         {% if item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="Item">
                        {% else %}
                            <img src="{{ item.product.image_url }}" alt="Item">
                        {% endif %}
                        <span class="qty-badge">{{ item.quantity }}</span>
                    </div>
                    <div class="item-info">
                        <p>{{ item.product.name }}</p>
                    </div>
                    <p class="item-price">${{ item.get_cost }}</p>
                </div>
                {% endfor %}
                <hr>
                <div class="calc-row total">
                    <span>Total</span>
                    <span class="final-price">USD ${{ cart.get_total }}</span>
                </div>
            </aside>
        </div>
    </main>

    <script>
        function validateStrictNumber(input) {
            if (/[^0-9]/.test(input.value)) {
                alert("This field allows only numbers.");
                input.value = input.value.replace(/[^0-9]/g, '');
            }
        }
    </script>

    <!-- ADMIN FLOATING BUTTON -->
    {% if user.is_authenticated and user.is_superuser %}
        <a href="{% url 'admin_dashboard' %}" class="floating-admin-btn">
            ‚öôÔ∏è Admin Panel
        </a>
    {% endif %}
</body>
</html>
