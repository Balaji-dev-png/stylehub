{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        // Inject theme early to prevent flash of white content
        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.name }} | Stylehub</title>
    <link rel="stylesheet" href="{% static 'theme.css' %}?v=3">
    <link rel="stylesheet" href="{% static 'style3.css' %}?v=2">
    <script src="{% static 'main.js' %}?v=3" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* FIX FOR DARK MODE SIZE BUTTON HOVER CACHING ISSUE */
        [data-theme="dark"] .size-options button:hover:not(.selected) {
            border-color: #ffffff !important;
            color: #ffffff !important;
        }

        /* Make sure default size buttons are visible in dark mode */
        [data-theme="dark"] .size-options button {
            color: #aaaaaa;
            border-color: #444444;
        }
    </style>
</head>

<body>

    <header>
        <nav class="navbar">
            <a href="{% url 'home' %}" style="text-decoration: none; color: inherit;"><div class="logo">Style<span>hub</span></div></a>
            <ul class="nav-links">
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'pro_list' %}" class="active">Shop</a></li>
                <li><a href="{% url 'new' %}">New Arrivals</a></li>
                <li><a href="{% url 'contact' %}">Contact</a></li>

                {% if user.is_authenticated %}
                <li><a href="{% url 'profile' %}">Profile</a></li>
                {% else %}
                <li><a href="{% url 'auth' %}">Login</a></li>
                {% endif %}
            </ul>
            <div class="nav-icons" style="display: flex; align-items: center;">
                <form action="{% url 'search_result' %}" method="GET" class="search-form">
                    <input type="text" name="q" class="search-input" placeholder="Search..." required>
                    <button type="submit" class="search-btn">üîç</button>
                </form>
                <a href="{% url 'cart' %}" class="cart-link">
                    üõí <span class="global-badge">{{ cart_count|default:0 }}</span>
                </a>
                <button id="theme-toggle" class="theme-toggle">üåô</button>
            </div>
        </nav>
    </header>

    <main class="product-container reveal-on-scroll">
        <div class="image-gallery">
            <div class="main-image-wrapper">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" id="featured">
                {% else %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}" id="featured">
                {% endif %}
            </div>
        </div>

        <div class="product-details">
            <div class="top-nav">
                <a href="{% url 'pro_list' %}" class="back-link">‚Üê</a>
                <span class="breadcrumb">Home ‚Ä¢ {{ product.category.name }} ‚Ä¢ {{ product.name }}</span>
            </div>

            <span class="category-pill">{{ product.category.name }}</span>

            <h1>{{ product.name }}</h1>
            <p class="price">${{ product.price }}</p>

            <div class="timer-box">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <p>Order in <span>02:30:25</span> to get next day delivery</p>
            </div>

            <p class="option-label">Select Size</p>
            <div class="size-options" id="size-selector">
                <button type="button">S</button>
                <button type="button" class="selected">M</button>
                <button type="button">L</button>
                <button type="button">XL</button>
                <button type="button">XXL</button>
            </div>

            <div class="action-buttons">
                <a href="{% url 'add_to_cart' product.id %}" class="ajax-add-to-cart"
                    style="flex:1; text-decoration: none;">
                    <button class="add-to-cart-btn" id="add-to-cart-main">Add to Cart</button>
                </a>

                {% if user.is_authenticated %}
                <a href="{% url 'toggle_wishlist' product.id %}"
                    class="wishlist-btn {% if in_wishlist %}active{% endif %}" title="Toggle Wishlist">
                    {% if in_wishlist %}‚ù§Ô∏è{% else %}‚ô°{% endif %}
                </a>
                {% else %}
                <a href="{% url 'auth' %}" class="wishlist-btn" title="Login to save">‚ô°</a>
                {% endif %}
            </div>

            <div class="info-card">
                <div class="info-header">
                    <span>Description</span>
                    <span>^</span>
                </div>
                <div class="info-content">
                    {{ product.description }}
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer reveal-on-scroll">
        <div class="footer-content">
            <div class="footer-brand">
                <a href="{% url 'home' %}" style="text-decoration: none; color: inherit;"><h2 class="footer-logo">Stylehub‚Ñ¢</h2></a>
                <p>We offer a wide range of fashion products to meet all your needs, from casual fits to formal
                    elegance.</p>
                <div class="social-icons">
                    <a href="#">üì∑</a>
                    <a href="#">fb</a>
                    <a href="#">‚úï</a>
                </div>
            </div>
            <div class="footer-links">
                <h3>Extra links</h3>
                <ul>
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'pro_list' %}">Shop</a></li>
                    <li><a href="{% url 'new' %}">New Arrivals</a></li>
                    <li><a href="{% url 'contact' %}">Our Team</a></li>
                    <li><a href="{% url 'about' %}">About Us</a></li>
                </ul>
            </div>
            <div class="footer-contact">
                <h3>Contact</h3>
                <p>123 Fashion Street<br>Mumbai, MH 400001</p>
                <p><a href="{% url 'team_emails' %}">Team Emails Directory</a></p>
                <p>(+91) 98765 43210</p>
            </div>
        </div>
    </footer>

    <!-- SCRIPT TO MAKE SIZE BUTTONS CLICKABLE -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sizeButtons = document.querySelectorAll('#size-selector button');

            sizeButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // Remove 'selected' class from all buttons
                    sizeButtons.forEach(btn => btn.classList.remove('selected'));
                    // Add 'selected' class to the clicked button
                    this.classList.add('selected');
                });
            });
        });
    </script>

    <!-- ADMIN FLOATING BUTTON -->
    {% if user.is_authenticated and user.is_superuser %}
    <a href="{% url 'admin_dashboard' %}" class="floating-admin-btn">
        ‚öôÔ∏è Admin Panel
    </a>
    {% endif %}
</body>

</html>